<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Last War 3D Runner</title>
<style>
  body { margin:0; display:flex; align-items:center; justify-content:center; height:100vh; background:#0b1020; font-family:sans-serif; overflow:hidden; }
  canvas { background:linear-gradient(180deg,#071127,#0b1020); border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,0.6); }
  #overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); color:white; flex-direction:column; }
  button { margin-top:12px; padding:10px 16px; border:none; border-radius:8px; background:#6ef0b1; font-weight:bold; cursor:pointer; }
</style>
</head>
<body>
<canvas id="game" width="400" height="640"></canvas>
<div id="overlay">
  <h2>Last War 3D Runner</h2>
  <p>Arrow keys or swipe to move lanes.</p>
  <button id="startBtn">Start</button>
</div>
<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const overlay=document.getElementById('overlay');
const startBtn=document.getElementById('startBtn');

let running=false;
let score=0;
let speed=4;

// Player state
let player={lane:1,y:0}; // lane: 0 left, 1 middle, 2 right
const laneCount=3;

// Obstacles and pickups
let objects=[];

function resetGame(){
  score=0;
  speed=4;
  player.lane=1;
  objects=[];
}

// perspective transform: map z-depth to screen size & y-position
function project(z){
  const scale=1/(z*0.003+0.2); // closer z -> bigger scale
  const y=canvas.height - z*0.5;
  return {scale,y};
}

function spawnObject(type){
  const lane=Math.floor(Math.random()*laneCount);
  objects.push({lane,z:1000,type});
}

function update(){
  objects.forEach(o=>o.z-=speed);

  // collisions when object reaches z ~ 0
  for(let i=0;i<objects.length;i++){
    let o=objects[i];
    if(o.z<80){
      if(o.lane===player.lane){
        if(o.type==='obstacle'){
          running=false;
          overlay.style.display='flex';
          overlay.innerHTML=`<h2>Game Over</h2><p>Score: ${score}</p><button onclick=\"location.reload()\">Restart</button>`;
        }
        if(o.type==='pickup'){
          score+=10;
        }
      }
      objects.splice(i,1); i--;
    }
  }

  // spawn new objects randomly
  if(Math.random()<0.02) spawnObject('obstacle');
  if(Math.random()<0.01) spawnObject('pickup');

  speed+=0.001; // slowly speed up
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // draw floating platform (simple trapezoid)
  ctx.fillStyle='#1a2a3a';
  ctx.beginPath();
  ctx.moveTo(60,canvas.height);
  ctx.lineTo(340,canvas.height);
  ctx.lineTo(250,100);
  ctx.lineTo(150,100);
  ctx.closePath();
  ctx.fill();

  // draw lanes lines
  ctx.strokeStyle='rgba(255,255,255,0.2)';
  ctx.beginPath();
  ctx.moveTo(170,100); ctx.lineTo(110,canvas.height);
  ctx.moveTo(230,100); ctx.lineTo(290,canvas.height);
  ctx.stroke();

  // draw objects
  objects.forEach(o=>{
    const {scale,y}=project(o.z);
    const laneX=[140,200,260];
    const x=laneX[o.lane];
    const size=30*scale;
    if(o.type==='obstacle') ctx.fillStyle='#ff7a7a'; else ctx.fillStyle='#ffd86b';
    ctx.fillRect(x-size/2,y-size/2,size,size);
  });

  // draw player (at bottom)
  const laneX=[140,200,260];
  ctx.fillStyle='#6ef0b1';
  ctx.fillRect(laneX[player.lane]-20,canvas.height-80,40,40);

  // score
  ctx.fillStyle='#fff';
  ctx.font='16px sans-serif';
  ctx.fillText(`Score: ${score}`,12,24);
}

function loop(){
  if(!running) return;
  update();
  draw();
  requestAnimationFrame(loop);
}

// controls
window.addEventListener('keydown',e=>{
  if(!running) return;
  if(e.key==='ArrowLeft'&&player.lane>0) player.lane--;
  if(e.key==='ArrowRight'&&player.lane<2) player.lane++;
});

let touchStartX=null;
canvas.addEventListener('touchstart',e=>{touchStartX=e.touches[0].clientX;});
canvas.addEventListener('touchend',e=>{
  if(touchStartX===null) return;
  let dx=e.changedTouches[0].clientX-touchStartX;
  if(Math.abs(dx)>30){
    if(dx<0 && player.lane>0) player.lane--;
    if(dx>0 && player.lane<2) player.lane++;
  }
  touchStartX=null;
});

startBtn.addEventListener('click',()=>{
  resetGame();
  overlay.style.display='none';
  running=true;
  requestAnimationFrame(loop);
});
</script>
</body>
</html>
