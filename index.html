<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Last War Runner (Ad-style)</title>
<style>
  body { margin:0; display:flex; align-items:center; justify-content:center; height:100vh; background:#0b1020; font-family:sans-serif; }
  canvas { background:linear-gradient(180deg,#071127,#0b1020); border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,0.6); }
  #overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); color:white; flex-direction:column; }
  button { margin-top:12px; padding:10px 16px; border:none; border-radius:8px; background:#6ef0b1; font-weight:bold; cursor:pointer; }
</style>
</head>
<body>
<canvas id="game" width="360" height="640"></canvas>
<div id="overlay">
  <h2>Last War Runner</h2>
  <p>Swipe or use arrow keys to dodge obstacles and collect allies!</p>
  <button id="startBtn">Start</button>
</div>
<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const overlay=document.getElementById('overlay');
const startBtn=document.getElementById('startBtn');

// game state
let running=false;
let player={lane:1,y:520,size:40}; // lane: 0 left, 1 middle, 2 right
let laneX=[90,180,270];
let obstacles=[];
let pickups=[];
let speed=3;
let score=0;

function resetGame(){
  player.lane=1;
  obstacles=[];
  pickups=[];
  score=0;
  speed=3;
}

function spawnObstacle(){
  const lane=Math.floor(Math.random()*3);
  obstacles.push({lane:lane,y:-40,size:40});
}

function spawnPickup(){
  const lane=Math.floor(Math.random()*3);
  pickups.push({lane:lane,y:-30,size:24});
}

function update(){
  // move obstacles and pickups
  obstacles.forEach(o=>o.y+=speed);
  pickups.forEach(p=>p.y+=speed);

  // collision check
  for(let i=0;i<obstacles.length;i++){
    const o=obstacles[i];
    if(o.lane===player.lane && Math.abs(o.y-player.y)<40){
      running=false; // game over
      overlay.style.display='flex';
      overlay.innerHTML=`<h2>Game Over</h2><p>Score: ${score}</p><button onclick=\"location.reload()\">Restart</button>`;
    }
  }
  for(let i=0;i<pickups.length;i++){
    const p=pickups[i];
    if(p.lane===player.lane && Math.abs(p.y-player.y)<40){
      score+=10;
      pickups.splice(i,1);
      i--;
    }
  }

  // remove off-screen
  obstacles=obstacles.filter(o=>o.y<canvas.height+40);
  pickups=pickups.filter(p=>p.y<canvas.height+40);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // draw lanes
  ctx.strokeStyle='rgba(255,255,255,0.1)';
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(120,0); ctx.lineTo(120,640);
  ctx.moveTo(240,0); ctx.lineTo(240,640);
  ctx.stroke();

  // draw player
  ctx.fillStyle='#6ef0b1';
  ctx.fillRect(laneX[player.lane]-player.size/2,player.y-player.size/2,player.size,player.size);

  // draw obstacles
  ctx.fillStyle='#ff7a7a';
  obstacles.forEach(o=>{
    ctx.fillRect(laneX[o.lane]-o.size/2,o.y-o.size/2,o.size,o.size);
  });

  // draw pickups
  ctx.fillStyle='#ffd86b';
  pickups.forEach(p=>{
    ctx.beginPath();
    ctx.arc(laneX[p.lane],p.y,p.size/2,0,Math.PI*2);
    ctx.fill();
  });

  // score
  ctx.fillStyle='#fff';
  ctx.font='16px sans-serif';
  ctx.fillText(`Score: ${score}`,12,24);
}

let lastSpawn=0;
let lastPickup=0;
function loop(timestamp){
  if(!running) return;
  update();
  draw();

  if(timestamp-lastSpawn>1200){
    spawnObstacle();
    lastSpawn=timestamp;
  }
  if(timestamp-lastPickup>2000){
    spawnPickup();
    lastPickup=timestamp;
  }

  requestAnimationFrame(loop);
}

// controls
window.addEventListener('keydown',e=>{
  if(!running) return;
  if(e.key==='ArrowLeft'&&player.lane>0) player.lane--;
  if(e.key==='ArrowRight'&&player.lane<2) player.lane++;
});

let touchStartX=null;
canvas.addEventListener('touchstart',e=>{touchStartX=e.touches[0].clientX;});
canvas.addEventListener('touchend',e=>{
  if(touchStartX===null) return;
  let dx=e.changedTouches[0].clientX-touchStartX;
  if(Math.abs(dx)>30){
    if(dx<0 && player.lane>0) player.lane--;
    if(dx>0 && player.lane<2) player.lane++;
  }
  touchStartX=null;
});

startBtn.addEventListener('click',()=>{
  resetGame();
  overlay.style.display='none';
  running=true;
  requestAnimationFrame(loop);
});
</script>
</body>
</html>
